<wave-sidenav-header>GEO-BON</wave-sidenav-header>
<div>
    <mat-card class="ebv-selection">
        <mat-card-header fxLayout="row" fxLayoutAlign="space-between center"  fxLayoutGap="1rem">
            <mat-select placeholder = "Dataset" fxFlex>
                <mat-option *ngFor="let source of (sources | async)" [value]="source.name" (click)="selectSource(source)" [matTooltip]="source.name">
                    {{source.name}}
                </mat-option>
            </mat-select>
            <mat-select placeholder = "Metric" fxFlex>
                <mat-option *ngFor="let layer of (ebvLayers | async)" [value]="layer.name" (click)="selectEBVLayer(layer)" [matTooltip]="layer.name">
                    {{layer.name}}
                </mat-option>
            </mat-select>
        </mat-card-header>
        <mat-card-content fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="1rem"
                          *ngIf="selectedSource && selectedSource.descriptionText">
            <img src="{{selectedSource.imgUrl}}" *ngIf="selectedSource.imgUrl">
            <p fxFlex [innerHTML]="selectedSource.descriptionText | waveSafeHtml"></p>
        </mat-card-content>
    </mat-card>

    <mat-card>
        <mat-card-header>
            <mat-card-title>Plot Options</mat-card-title>
        </mat-card-header>
        <mat-card-content fxLayout="row" fxLayoutAlign="space-between center">
            <wave-country-selection (layer)="setCountryLayer($event)"
                                    [style.minWidth.%]="20"
                                    [style.width.%]="20"></wave-country-selection>
            <mat-select #timestartselect [(ngModel)]="time_start" [style.minWidth.%]="20" [style.width.%]="20">
                <mat-option *ngFor="let y of (years_start$ | async)" [value]="y">
                    {{y}}
                </mat-option>
            </mat-select>
            <mat-select #timeendselect [(ngModel)]="time_end" [style.minWidth.%]="20" [style.width.%]="20">
                <mat-option *ngFor="let y of (years_end$ | async)" [value]="y">
                    {{y}}
                </mat-option>
            </mat-select>
            <mat-select [(ngModel)]="aggregation_fn" [style.minWidth.%]="20" [style.width.%]="20">
                <mat-option value="sum">sum</mat-option>
                <mat-option value="fraction">fraction</mat-option>
                <mat-option value="mean">average</mat-option>
            </mat-select>
        </mat-card-content>
    </mat-card>

    <button mat-raised-button type="submit" color="primary" [disabled]="!ebvLayer || (!countryLayer && isCountryLayer)" (click)="reload()">Calculate</button>

    <!-- Plot -->
    <mat-card class="plot" fxLayout="row" fxLayoutAlign="space-between" *ngIf="plot">
        <mat-card-content *ngIf="(plotDataState$ | async) === LoadingState.LOADING">
            <mat-spinner></mat-spinner>
        </mat-card-content>
        <mat-card-content style="padding-right: 1rem; margin-bottom: 0;" *ngIf="(plotDataState$ | async) === LoadingState.OK">
            <div [style.width.px] = "(cardHeight$ | async) - 4 * 16"
                 [style.height.px] = "(cardHeight$ | async) - 4 * 16">
                <img src="data:image/png;base64,{{(plotData$ | async)?.data}}" alt="{{plot.name}}">
            </div>
        </mat-card-content>
        <mat-card-actions *ngIf="(plotDataState$ | async) === LoadingState.OK" fxLayout="column" fxLayoutAlign="start start">
            <button mat-button (click)="showFullscreenPlot(plot)"><mat-icon>fullscreen</mat-icon></button>
        </mat-card-actions>
    </mat-card>
</div>
